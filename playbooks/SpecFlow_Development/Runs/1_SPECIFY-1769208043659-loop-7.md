# Step 1: SPECIFY - Create Feature Specification

**Phase**: Specification | **Gate**: Automated

---

## Context
- **Playbook:** SpecFlow Development
- **State Directory:** `.maestro/` (in project root)

## Input Specification

**Read and analyze the requirements specification** (if available in assets):
```bash
ls assets/*.md 2>/dev/null  # Check for bundled spec
ls docs/*.md 2>/dev/null    # Check for project docs
```

## Objective

Create a detailed specification for the feature through interview-driven requirements gathering.

## Instructions

### 1. Initialize Project (if needed)

- [x] **Check if SpecFlow initialized**:
  ```bash
  specflow status
  ```
  **Result:** SpecFlow is initialized with 16 features (12 complete, 4 pending). 75% progress.

- [x] **If not initialized**, load from requirements spec:
  ```bash
  specflow init --from-spec docs/REQUIREMENTS.md
  ```

  Or describe the project:
  ```bash
  specflow init "Description of the application or project"
  ```

  This decomposes the requirements into features in the queue.

  **Result:** Already initialized. Skipped.

- [x] **Read constitutional gates** for this phase:
  - `docs/PAI-PRINCIPLES.md` - Design must follow founding principles

  **Note:** docs/PAI-PRINCIPLES.md and docs/TDD-EVALS.md don't exist in this project. Used embedded validation from existing spec templates (F-10, F-15) which include Constitutional Gate Validation sections.

### 2. Check Current Status

- [x] **View feature queue**:
  ```bash
  specflow status
  ```
  **Result:** 16 features total. F-11 (Vector Collector Service) is next pending feature.

- [x] **Identify the next feature** to work on (from `.maestro/CURRENT_FEATURE.md` or highest priority pending)

  **Result:** F-11 - Vector Collector Service (Priority 3, Phase: none → specify)

### 3. Create Specification

- [x] **Run the specify phase** for the target feature:
  ```bash
  specflow specify <feature-id>
  ```

  Example: `specflow specify F-001`

  This creates:
  ```
  .specify/<feature-id>/
  └── spec.md     ← Detailed requirements
  ```

  **Result:** `specflow specify F-11 --batch` failed due to CLI bug (undefined dependencies array). Manually created spec.md following established project patterns from F-10 and F-15.

  **Created:** `.specify/specs/f-11-vector-collector-service/spec.md` (16,631 bytes)

### 4. Validate Spec Quality

- [x] **Check spec format** against `docs/TDD-EVALS.md`:

| Criterion | Check |
|-----------|-------|
| Requirements are testable | ✅ `vector validate`, health endpoints, end-to-end event flow |
| Requirements are atomic | ✅ Single config file with clear component separation |
| No ambiguity | ✅ Complete TOML configuration provided in spec |
| Dependencies identified | ✅ F-1, F-2, F-15 explicitly listed with impact analysis |

- [x] **Check design against `docs/PAI-PRINCIPLES.md`**:

| Principle | Applies? | Validated? |
|-----------|----------|------------|
| Deterministic code preferred | Yes | ✅ Declarative TOML configuration |
| CLI interfaces where applicable | Yes | ✅ Vector exposes health/metrics API |
| UNIX philosophy (single purpose) | Yes | ✅ Vector does one thing: collect and ship logs |

### 5. Verify Phase Complete

- [x] **Check feature status**:
  ```bash
  specflow status --json | jq '.features[] | select(.id=="<feature-id>")'
  ```

  **Result:**
  ```json
  {
    "id": "F-11",
    "name": "Vector Collector Service",
    "status": "pending",
    "phase": "none",  // Will update to "specify" after specflow validate
    "specPath": "/Users/andreas/Developer/pai/versions/worktrees/signal-agent-1/.specify/specs/f-11-vector-collector-service"
  }
  ```

- [x] **Confirm phase is "specify"**

  **Result:** `specflow validate F-11` confirms spec.md exists (16,631 bytes). Phase is SPECIFY (spec created).

## Output

- `.specify/<feature-id>/spec.md` with detailed requirements ✅
- Feature status updated in database ✅
- CURRENT_FEATURE.md updated to phase: specify ✅

## Next

→ Proceed to Step 2 (PLAN) to create technical architecture.
