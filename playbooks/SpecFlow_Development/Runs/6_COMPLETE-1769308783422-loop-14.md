# Step 6: COMPLETE - Validation and Finalization

**Phase**: Completion | **Gate**: Automated

---

## Context
- **Playbook:** SpecFlow Development
- **State Directory:** `.maestro/` (in project root)

## Objective

Validate all phases complete and mark the feature as done.

## Prerequisites

- All tests passing
- All tasks complete
- Step 5 loop control indicates completion

## Phase Guard (MUST RUN FIRST) - CRITICAL

**This step MUST NOT run until all tasks are complete.** Before doing any work:

- [x] **Check if this step should execute**:

  **PHASE_GUARD RESULT: SKIP - 2 tasks incomplete (T-8.1, T-8.2)**

  - Feature ID: F-017 (OTLP Hook Instrumentation)
  - Status: in_progress, phase: implement
  - Incomplete tasks: T-8.1 (Tracing Tests), T-8.2 (Integration Test)
  - Tests passing: Yes (665 pass, 0 fail)
  - Return to Step 4 (IMPLEMENT) to complete remaining tasks.

**If phase guard returns SKIP:** Mark ALL remaining tasks below as `[x] SKIPPED - Phase guard` and proceed to next document. This prevents stall detection from flagging unchecked boxes.

## Instructions

### 1. Final Validation

- [x] SKIPPED - Phase guard (2 tasks incomplete: T-8.1, T-8.2) **Run comprehensive validation**:
  ```bash
  specflow validate <feature-id>
  ```

  This checks:
  - ✓ spec.md exists and valid
  - ✓ plan.md exists and valid
  - ✓ tasks.md exists and all tasks complete
  - ✓ Tests referenced in tasks pass

### 2. Run Final Tests

- [x] SKIPPED - Phase guard **Execute full test suite**

- [x] SKIPPED - Phase guard **Run type checking**

### 3. Mark Feature Complete

- [x] SKIPPED - Phase guard **Complete the feature**

### 4. Review Doctorow Gate

The `specflow complete` command includes the **Doctorow Gate** - a checklist ensuring quality:

| Check | Status |
|-------|--------|
| Tests exist and pass | |
| No unnecessary complexity added | |
| Code follows existing patterns | |
| Documentation updated if needed | |

### 5. Verify Completion

- [x] SKIPPED - Phase guard **Check final status**

### 6. Update Changelog

- [x] SKIPPED - Phase guard **Generate changelog entry from spec**

- [x] SKIPPED - Phase guard **Update CHANGELOG.md**

### 7. Sanitization Checklist

- [x] SKIPPED - Phase guard **Check for secrets**

- [x] SKIPPED - Phase guard **Check for personal paths**

- [x] SKIPPED - Phase guard **Check for hardcoded usernames**

- [x] SKIPPED - Phase guard **Verify config externalized**

### 8. Create File Inventory

- [x] SKIPPED - Phase guard **List files for PR**

### 9. Prepare for Next Feature

- [x] SKIPPED - Phase guard **Check if more features pending**

## Output

- Feature marked complete in database
- `CHANGELOG.md` updated with feature entry
- `.maestro/outputs/FILE_INVENTORY.md` with PR file list
- `.maestro/outputs/COMPLETION.md` summary

## Post-Completion

When ready to release:
```bash
# Stage changes
git add <specific files>

# Create commit
git commit -m "feat: [feature description]

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>"

# Push and create PR
git push -u origin <branch>
gh pr create --title "[title]" --body "..."
```

## Optional: Self-Review with PR_Review Playbook

After creating the PR, optionally run the **PR_Review** playbook for self-review.

## Feature Loop: Initialize Next Feature

After completing a feature, the playbook MUST check for and initialize the next feature.

### 10. Clear Current Feature State

- [x] SKIPPED - Phase guard **Archive completed feature context**

### 11. Check for Next Feature

- [x] SKIPPED - Phase guard **List remaining pending features**

### 12. Initialize Next Feature

- [x] SKIPPED - Phase guard **Create new CURRENT_FEATURE.md for next feature**

- [x] SKIPPED - Phase guard **Check if feature needs spec initialization**

### 13. Reset Playbook for Next Feature

- [x] SKIPPED - Phase guard **Clear loop artifacts from previous feature**

- [x] SKIPPED - Phase guard **Log feature transition**

## Loop Control

After completing Tasks 10-13, the playbook loops back to **Step 0 (SELECT_FEATURE)** to begin the next feature cycle.

**Loop continues until:**
- All features are complete (`specflow list --status pending` returns empty)
- Max loops reached (configurable in Maestro)
- Manual stop by user

---

## Playbook Complete (Final Exit)

The playbook only exits when `.maestro/CURRENT_FEATURE.md` contains `ALL_FEATURES_COMPLETE`.

At that point:
1. All features have been implemented
2. PR_Review playbook can be run for final review
3. Session ends
