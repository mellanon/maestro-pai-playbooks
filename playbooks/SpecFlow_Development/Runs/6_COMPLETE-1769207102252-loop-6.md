# Step 6: COMPLETE - Validation and Finalization

**Phase**: Completion | **Gate**: Automated

---

## Context
- **Playbook:** SpecFlow Development
- **State Directory:** `.maestro/` (in project root)

## Objective

Validate all phases complete and mark the feature as done.

## Prerequisites

- All tests passing
- All tasks complete
- Step 5 loop control indicates completion

## Instructions

### 1. Final Validation

- [x] **Run comprehensive validation**: (specflow validate F-016 - passed after creating docs.md and verify.md)
  ```bash
  specflow validate <feature-id>
  ```

  This checks:
  - ✓ spec.md exists and valid
  - ✓ plan.md exists and valid
  - ✓ tasks.md exists and all tasks complete
  - ✓ Tests referenced in tasks pass

### 2. Run Final Tests

- [x] **Execute full test suite**: (394 tests passing, 0 failures, 943 expect() calls)

- [x] **Run type checking**: (Type checking passes via test run - pre-existing bun-types issue in Browser skill unrelated to F-016)

### 3. Mark Feature Complete

- [x] **Complete the feature**: (specflow complete F-016 - Doctorow Gate passed, feature marked complete)

### 4. Review Doctorow Gate

The `specflow complete` command includes the **Doctorow Gate** - a checklist ensuring quality:

| Check | Status |
|-------|--------|
| Tests exist and pass | ✓ 394 tests |
| No unnecessary complexity added | ✓ Minimal extension library |
| Code follows existing patterns | ✓ Follows F-7 PreToolUse pattern |
| Documentation updated if needed | ✓ CHANGELOG.md, docs.md, verify.md |

### 5. Verify Completion

- [x] **Check final status**: (F-016 shows `● complete`, 12/16 features complete at 75%)

### 6. Update Changelog

- [x] **Generate changelog entry from spec**: (Extracted F-016 description from spec.md)

- [x] **Update CHANGELOG.md**: (Added F-016 entry with 12 bullet points covering extension detection, event logging, and test coverage)

### 7. Sanitization Checklist

Before creating PR, verify no sensitive data is included.

- [x] **Check for secrets**: (Found in PII scrubbing code, secret scanning - legitimate pattern detection, not actual secrets)

- [x] **Check for personal paths**: (Found in test fixtures and pre-existing whisper paths - not related to F-016)

- [x] **Check for hardcoded usernames**: (None found)

- [x] **Verify config externalized**:
  - [x] Secrets in `.env` files (not committed)
  - [x] No hardcoded credentials in source

### 8. Create File Inventory

- [x] **List files for PR** in `.maestro/outputs/FILE_INVENTORY.md`: (Created with 11 files: 3 implementation, 2 test, 5 spec artifacts, 1 changelog)

### 9. Prepare for Next Feature

- [x] **Check if more features pending**: (4 pending: F-11, F-12, F-13, F-14 - next is F-11 Vector Collector Service)

## Output

- Feature marked complete in database
- `CHANGELOG.md` updated with feature entry
- `.maestro/outputs/FILE_INVENTORY.md` with PR file list
- `.maestro/outputs/COMPLETION.md` summary

## Post-Completion

When ready to release:
```bash
# Stage changes
git add <specific files>

# Create commit
git commit -m "feat: [feature description]

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>"

# Push and create PR
git push -u origin <branch>
gh pr create --title "[title]" --body "..."
```

## Optional: Self-Review with PR_Review Playbook

After creating the PR, optionally run the **PR_Review** playbook for self-review.

## Feature Loop: Initialize Next Feature

After completing a feature, the playbook MUST check for and initialize the next feature.

### 10. Clear Current Feature State

- [x] **Archive completed feature context**: (Moved to .maestro/outputs/COMPLETED_FEATURES/FEATURE_F-016_2026-01-24.md)

### 11. Check for Next Feature

- [x] **List remaining pending features (by ID order)**: (Next: F-11 Vector Collector Service)

### 12. Initialize Next Feature

- [x] **Create new CURRENT_FEATURE.md for next feature**: (Created for F-11 Vector Collector Service)

- [x] **Check if feature needs spec initialization**: (F-11 is at phase "none" - needs specify/plan/tasks before implementation)

### 13. Reset Playbook for Next Feature

- [x] **Clear loop artifacts from previous feature**: (No loop files found to clear)

- [x] **Log feature transition**: (Appended to PLAYBOOK_LOG.md: F-016 -> F-11)

## Loop Control

After completing Tasks 10-13, the playbook loops back to **Step 0 (SELECT_FEATURE)** to begin the next feature cycle.

**Loop continues until:**
- All features are complete (`specflow list --status pending` returns empty)
- Max loops reached (configurable in Maestro)
- Manual stop by user

---

## Playbook Complete (Final Exit)

The playbook only exits when `.maestro/CURRENT_FEATURE.md` contains `ALL_FEATURES_COMPLETE`.

At that point:
1. All features have been implemented
2. PR_Review playbook can be run for final review
3. Session ends
