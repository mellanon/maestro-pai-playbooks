# Step 5: VERIFY - Quality Gates and Loop Control

**Phase**: Verification | **Loop Control**: Determines next action

---

## Context
- **Playbook:** SpecFlow Development
- **State Directory:** `.maestro/` (in project root)

## Objective

Verify implementation progress and determine whether to continue looping or proceed to completion.

## Instructions

### 1. Run Test Suite

- [x] **Execute all tests**:
  ```bash
  bun test
  # or project-specific test command
  ```
  ✅ All 143 tests pass (428 expect() calls)

- [x] **Record results** in `.maestro/outputs/LOOP_TEST_RESULTS.md`:
  ✅ Results recorded with full task progress tracking

### 2. Check Feature Progress

- [x] **View current status**:
  ```bash
  specflow status
  ```
  ✅ F-3 in "tasks" phase, status "pending" - 1/10 tasks complete

- [x] **Validate feature phases complete**:
  ```bash
  specflow validate F-3
  ```
  ✅ Validated:
  - spec.md exists (11,782 bytes)
  - plan.md exists (29,251 bytes)
  - tasks.md exists (9,732 bytes)
  - docs.md missing (required before complete)

### 3. Validate Against TDD-EVALS

- [x] **Check eval criteria**:

| Criterion | Pass? |
|-----------|-------|
| Tests are deterministic | ✅ Yes |
| Outcomes verifiable | ✅ Yes |
| Regression suite growing | ✅ Yes (143 tests) |

### 4. Loop Decision

| Condition | Action |
|-----------|--------|
| Tests fail | → **Loop back to Step 4** (fix) |
| Tasks remain incomplete | → **Loop back to Step 4** (next task) |
| All tasks complete, tests pass | → **Proceed to Step 6** (complete) |
| Validation fails | → **STOP for human review** |

### Decision Logic

```
IF tests_failing:
    → Reset to Step 4, continue loop
ELIF incomplete_tasks > 0:
    → Reset to Step 4, continue loop
ELIF all_tasks_complete AND tests_pass:
    → Do NOT reset, proceed to Step 6
ELSE:
    → STOP for human review
```

## Output

- `.maestro/outputs/LOOP_TEST_RESULTS.md`

## Loop Control Settings

For Maestro Auto Run:
- **This document (5_VERIFY.md)**: `Reset: ON`
- **Step 4**: Gets reset by this document's logic
- **Steps 1-3**: `Reset: OFF` (run once, not in loop)

When this document completes:
- If loop continues: Reset to Step 4
- If done: Allow Step 6 to run

---

## Loop 2 Decision

**Date**: 2026-01-24
**Condition**: Tasks remain incomplete (9 of 10 tasks pending for F-3)
**Action**: → **Loop back to Step 4** (next task: T-1.2 - Lock acquisition and release)

### Task Progress Summary
- T-1.1 ✅ Lock types and constants (completed)
- T-1.2 ⬜ Lock acquisition and release (NEXT)
- T-1.3 ⬜ Stale lock detection
- T-2.1 ⬜ Update logEvent with locking
- T-2.2 ⬜ Agent fallback filepath
- T-3.1 ⬜ Merge utility core
- T-3.2 ⬜ Agent file discovery
- T-4.1 ⬜ Update barrel exports
- T-4.2 ⬜ Concurrent stress tests
- T-4.3 ⬜ Performance benchmarks
