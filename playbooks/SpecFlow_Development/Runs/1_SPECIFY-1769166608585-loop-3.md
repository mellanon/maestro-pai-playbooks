# Step 1: SPECIFY - Create Feature Specification

**Phase**: Specification | **Gate**: Human Approval Required

---

## Context
- **Playbook:** SpecFlow Development
- **State Directory:** `.maestro/` (in project root)

## Input Specification

**Read and analyze the requirements specification** (if available in assets):
```bash
ls assets/*.md 2>/dev/null  # Check for bundled spec
ls docs/*.md 2>/dev/null    # Check for project docs
```

## Objective

Create a detailed specification for the feature through interview-driven requirements gathering.

## Instructions

### 1. Initialize Project (if needed)

- [x] **Check if SpecFlow initialized**: ✅ VERIFIED
  ```bash
  specflow status
  ```

  **Status:** SpecFlow is initialized with 15 features:
  - 2 complete (F-1, F-2)
  - 0 in progress
  - 13 pending (including F-3 which is in `tasks` phase)
  - Current feature: F-3 (Concurrent Write Handling) - already past specify phase

- [x] **If not initialized**, load from requirements spec: ✅ SKIPPED (already initialized)

  *Not applicable - SpecFlow is already initialized with 15 features as verified above.*

- [x] **Read constitutional gates** for this phase:
  - `docs/PAI-PRINCIPLES.md` - Design must follow founding principles

  **Status:** ✅ SKIPPED (file does not exist)

  The `docs/PAI-PRINCIPLES.md` file does not exist in this project (signal-agent-2 worktree). This is a feature branch implementing F-3 (Concurrent Write Handling) for the observability library. The spec was created by previous loops and follows SpecFlow methodology. The feature is already in the "tasks" phase, meaning SPECIFY phase is complete.

### 2. Check Current Status

- [x] **View feature queue**: ✅ VERIFIED
  ```bash
  specflow status
  ```

  **Status (Loop 3):**
  - 15 features total: 2 complete (F-1, F-2), 13 pending
  - F-3 (Concurrent Write Handling) is in `tasks` phase
  - Current feature: F-3 as confirmed in `.maestro/CURRENT_FEATURE.md`

- [x] **Identify the next feature**: ✅ F-3 IDENTIFIED

  From `.maestro/CURRENT_FEATURE.md`:
  - **Feature ID:** F-3
  - **Feature Name:** Concurrent Write Handling
  - **Phase:** tasks (already past specify)
  - **Tasks:** 1 of 10 complete (T-1.1 done, T-1.2 next)

### 3. Create Specification

- [x] **Run the specify phase**: ✅ ALREADY COMPLETE

  F-3 spec already exists at: `.specify/specs/f-3-concurrent-write-handling/spec.md`

  The specification is comprehensive (361 lines) and includes:
  - 4 user scenarios with acceptance criteria
  - 6 functional requirements (FR-1 through FR-6)
  - Performance targets and reliability scenarios
  - Security considerations
  - Dependencies (F-1, F-2) and downstream consumers
  - 9 success criteria checkboxes

  **No action needed** - SPECIFY phase was completed in prior loops.

### 4. Validate Spec Quality

- [x] **Check spec format** against `docs/TDD-EVALS.md`: ✅ VALIDATED

| Criterion | Check |
|-----------|-------|
| Requirements are testable | ✅ Each FR has explicit validation criteria |
| Requirements are atomic | ✅ 6 distinct FRs, each self-contained |
| No ambiguity | ✅ Code examples provided for all algorithms |
| Dependencies identified | ✅ F-1, F-2 upstream; F-5-F-9 downstream |

- [x] **Check design against `docs/PAI-PRINCIPLES.md`**: ✅ N/A

| Principle | Applies? | Validated? |
|-----------|----------|------------|
| Deterministic code preferred | ✅ Yes | ✅ Lock algorithm is deterministic |
| CLI interfaces where applicable | ⚪ N/A | Library, not CLI |
| UNIX philosophy (single purpose) | ✅ Yes | ✅ Each function has one job |

  **Note:** `docs/PAI-PRINCIPLES.md` does not exist in this worktree. Principles validated against PAI founding principles from CORE skill context.

### 5. Verify Phase Complete

- [x] **Check feature status**: ✅ VERIFIED

  F-3 is in `tasks` phase (beyond `specify`), with:
  - 10 implementation tasks defined
  - T-1.1 complete (Lock types and constants)
  - T-1.2 pending (Lock acquisition and release)

- [x] **Confirm phase is "specify"**: ✅ PHASE IS BEYOND SPECIFY

  F-3 has already progressed to `tasks` phase. SPECIFY phase is complete.

## Output

- `.specify/<feature-id>/spec.md` with detailed requirements
- Feature status updated in database

## Human Gate

**STOP** - Present spec to human for review before proceeding.

Show:
1. `spec.md` requirements
2. Feature description and rationale

**Only proceed to Step 2 after human approval.**
