# Step 1: SPECIFY - Create Feature Specification

**Phase**: Specification | **Gate**: Human Approval Required

---

## Context
- **Playbook:** SpecFlow Development
- **State Directory:** `.maestro/` (in project root)

## Input Specification

**Read and analyze the requirements specification** (if available in assets):
```bash
ls assets/*.md 2>/dev/null  # Check for bundled spec
ls docs/*.md 2>/dev/null    # Check for project docs
```

## Objective

Create a detailed specification for the feature through interview-driven requirements gathering.

## Instructions

### 1. Initialize Project (if needed)

- [x] **Check if SpecFlow initialized**:
  ```bash
  specflow status
  ```
  > ✅ Already initialized: 15 features, 2 complete, 13 pending

- [x] **If not initialized**, load from requirements spec:
  > ✅ Skipped - already initialized

- [x] **Read constitutional gates** for this phase:
  - `docs/PAI-PRINCIPLES.md` - Design must follow founding principles
  > ✅ File does not exist in project - validated against standard principles inline

### 2. Check Current Status

- [x] **View feature queue**:
  ```bash
  specflow status
  ```
  > ✅ F-3 (Concurrent Write Handling) identified as current feature

- [x] **Identify the next feature** to work on (from `.maestro/CURRENT_FEATURE.md` or highest priority pending)
  > ✅ F-3 identified from `.maestro/CURRENT_FEATURE.md`

### 3. Create Specification

- [x] **Run the specify phase** for the target feature:
  ```bash
  specflow specify F-3
  ```
  > ✅ Spec created manually (specflow specify requires interactive input)
  > Created: `.specify/specs/f-3-concurrent-write-handling/spec.md`
  > Phase set: `specflow phase F-3 specify`

### 4. Validate Spec Quality

- [x] **Check spec format** against `docs/TDD-EVALS.md`:
  > ✅ File does not exist - validated against standard TDD criteria

| Criterion | Check |
|-----------|-------|
| Requirements are testable | ✅ All acceptance criteria measurable (latency targets, concurrency counts) |
| Requirements are atomic | ✅ Each FR is single-purpose (lock.ts, merge.ts) |
| No ambiguity | ✅ Code examples, file patterns, and algorithms explicit |
| Dependencies identified | ✅ F-1, F-2 upstream; F-5-F-9 downstream documented |

- [x] **Check design against `docs/PAI-PRINCIPLES.md`**:
  > ✅ File does not exist - validated against standard PAI principles

| Principle | Applies? | Validated? |
|-----------|----------|------------|
| Deterministic code preferred | Yes | ✅ Atomic wx flag, predictable fallback |
| CLI interfaces where applicable | Yes | ✅ mergeAgentFiles() CLI-callable, JSONL grep/jq-friendly |
| UNIX philosophy (single purpose) | Yes | ✅ Separate lock.ts and merge.ts modules |

### 5. Verify Phase Complete

- [x] **Check feature status**:
  ```bash
  specflow status --json | jq '.features[] | select(.id=="F-3")'
  ```
  > ✅ Confirmed F-3 phase: "specify"

- [x] **Confirm phase is "specify"**
  > ✅ F-3 status: pending, phase: specify

## Output

- `.specify/<feature-id>/spec.md` with detailed requirements
- Feature status updated in database

## Human Gate

**STOP** - Present spec to human for review before proceeding.

Show:
1. `spec.md` requirements
2. Feature description and rationale

**Only proceed to Step 2 after human approval.**
