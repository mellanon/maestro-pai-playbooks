# Document 3: Compare Branches

## Context

- **Playbook**: SpecFlow PR Creator
- **Agent**: {{AGENT_NAME}}
- **Project**: {{AGENT_PATH}}
- **Date**: {{DATE}}
- **Working Folder**: {{AUTORUN_FOLDER}}

## Purpose

Analyze the differences between this feature branch and the target branch (develop). Categorize changes, identify potential conflicts, and highlight anything that needs special attention during merge.

## Prerequisites

- `{{AUTORUN_FOLDER}}/SPECFLOW_CONTEXT.md` exists
- `{{AUTORUN_FOLDER}}/CHANGELOG.md` exists

## Tasks

### Task 1: Get Branch Diff Statistics

- [ ] **Get overall diff stats**:
  ```bash
  git diff --stat develop...HEAD
  ```

- [ ] **Count changes by type**:
  ```bash
  git diff --numstat develop...HEAD | awk '{added+=$1; removed+=$2} END {print "Added:", added, "Removed:", removed}'
  ```

- [ ] **List all changed files**:
  ```bash
  git diff --name-status develop...HEAD
  ```

### Task 2: Categorize Changes

- [ ] **Identify file categories**:

  Group files by type:
  - **Source files** (*.ts, *.tsx, *.js)
  - **Test files** (*.test.ts, *.spec.ts)
  - **Configuration** (*.json, *.yaml, *.toml)
  - **Documentation** (*.md, *.txt)
  - **Build/CI** (Dockerfile, *.yml in .github/)

- [ ] **Map changes to features**:

  Cross-reference changed files with `.specify/specs/F-N-*/docs.md` to associate files with features.

### Task 3: Check for Conflicts

- [ ] **Attempt merge dry-run**:
  ```bash
  git fetch origin develop
  git merge-tree $(git merge-base HEAD origin/develop) origin/develop HEAD
  ```

- [ ] **Identify conflict-prone files**:
  - Files modified in both branches
  - Package.json / lock files
  - Configuration files

### Task 4: Analyze Breaking Changes

- [ ] **Check for removed exports**:
  Look for files that were deleted or had exports removed.

- [ ] **Check for API signature changes**:
  Review changed interfaces, function signatures.

- [ ] **Check for configuration changes**:
  New required environment variables, changed defaults.

### Task 5: Create Comparison Document

- [ ] **Write BRANCH_COMPARISON.md**: Create `{{AUTORUN_FOLDER}}/BRANCH_COMPARISON.md`:

```markdown
# Branch Comparison: [feature-branch] → develop

Generated: {{DATE}}
Agent: {{AGENT_NAME}}

## Overview

| Metric | Value |
|--------|-------|
| Commits ahead | [N] |
| Files changed | [N] |
| Lines added | +[N] |
| Lines removed | -[N] |
| Features included | [N] |

## Change Categories

### Source Files ([N] changed)

| File | Change | Feature | Description |
|------|--------|---------|-------------|
| `Observability/lib/events/index.ts` | Added | F-1 | Module entry point |
| `Observability/lib/events/types.ts` | Added | F-1 | Event type definitions |

### Test Files ([N] changed)

| File | Change | Tests | Description |
|------|--------|-------|-------------|
| `Observability/lib/events/__tests__/types.test.ts` | Added | 105 | Unit tests for event types |

### Configuration ([N] changed)

| File | Change | Impact |
|------|--------|--------|
| `package.json` | Modified | Added new dependency |

### Documentation ([N] changed)

| File | Change | Description |
|------|--------|-------------|
| `.specify/specs/f-1-*/docs.md` | Added | Feature documentation |

## Feature → File Mapping

### F-1: Event Schema and Types
- `Observability/lib/events/` (new directory)
  - `index.ts`
  - `types.ts`
  - `guards.ts`
  - `factories.ts`
  - `__tests__/`

### F-2: Event Logging Library
- [files...]

## Conflict Analysis

### Potential Merge Conflicts

| Risk | File | Reason |
|------|------|--------|
| Low | None detected | - |

OR

| Risk | File | Reason |
|------|------|--------|
| High | `package.json` | Modified in both branches |
| Medium | `settings.json` | Configuration changes |

### Resolution Strategy

[For each conflict-prone file, suggest resolution approach]

## Breaking Changes

### Removed Exports
- **None** (or list removed exports)

### Changed APIs
- **None** (or list changed function signatures)

### New Requirements
- **Environment variables**: [list]
- **Dependencies**: [list]
- **Configuration**: [list]

## Merge Readiness

| Check | Status |
|-------|--------|
| Clean diff | ✓/✗ |
| No high-risk conflicts | ✓/✗ |
| Tests pass | ✓/✗ |
| Docs updated | ✓/✗ |

## Commit History

```
[output of git log --oneline develop..HEAD]
```

---

*Generated by SpecFlow PR Creator Playbook*
```

## Success Criteria

- BRANCH_COMPARISON.md created with full analysis
- All changed files categorized
- Conflict risks identified
- Breaking changes documented

## Status

Mark complete when branch comparison is documented.
